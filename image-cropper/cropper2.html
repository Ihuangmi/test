<!-- ä½¿ç”¨ canvas å®ç°è£å‰ªå›¾ç‰‡ -->
<!DOCTYPE html>
<html>
  <head>
    <style>
      canvas {
        border: 1px solid #ccc;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <input id="file" type="file" />
    <canvas id="canvas"></canvas>
    <button id="btn">è£å‰ª</button>
    <canvas id="canvasCropping"></canvas>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const file = document.getElementById("file");
        const canvas = document.getElementById("canvas");
        const canvasCtx = canvas.getContext("2d");
        const canvasCropping = document.getElementById("canvasCropping");
        const canvasCroppingCtx = canvasCropping.getContext("2d");

        const image = new Image();

        // ä¸Šä¼ å›¾ç‰‡
        file.addEventListener("change", (e) => {
          const file = e.target.files[0];
          image.src = URL.createObjectURL(file);
          image.onload = () => {
            // å°†ç”»å¸ƒå¤§å°è°ƒæ•´æˆç…§ç‰‡å¤§å°
            const { width, height } = image;
            canvas.width = width;
            canvas.height = height;
            // å°†å›¾ç‰‡ç»˜åˆ¶åˆ°ç”»å¸ƒä¸­
            canvasCtx.drawImage(image, 0, 0, width, height);

            // getImageData ç”¨äºè·å–ç”»å¸ƒä¸­çš„æŸä¸ªåŒºåŸŸå†…å®¹ï¼Œè£å‰ªå‡ºåæ ‡ä¸º(0, 0)ï¼Œwidthä¸heightéƒ½ä¸º100çš„ç…§ç‰‡
            const croppingImageData = canvasCtx.getImageData(0, 0, 100, 100);
            console.log(
              "ğŸš€ ~ file.addEventListener ~ croppingImageData:",
              croppingImageData
            );
            // å°† ImageData å¯¹è±¡ç»˜åˆ¶åˆ°ç”»å¸ƒä¸­
            canvasCroppingCtx.putImageData(croppingImageData, 0, 0);
          };
        });

        // ç‚¹å‡»è£å‰ª
        const btn = document.getElementById("btn");
        btn.addEventListener("click", () => {
          // currentDimention: top/right/bottom/left
          if (currentDimention.length > 0) {
            // å›¾ç‰‡çš„å®½åº¦ä¸é«˜åº¦
            const { width: imageWidth, height: imageHeight } =
              bgImage.getBoundingClientRect();
            // åˆ›å»ºä¸€ä¸ªcanvasç”¨äºè£å‰ªæ“ä½œï¼Œå…¶å®ä¹Ÿå¯ä»¥å°†bgImageæœ¬èº«å˜æˆä¸€ä¸ªcanvasï¼Œç›´æ¥åœ¨ä¸Šé¢æ“ä½œå°±è¡Œ
            const canvas = document.createElement("canvas");
            const canvasCtx = canvas.getContext("2d");
            canvas.width = imageWidth;
            canvas.height = imageHeight;
            // ç»˜åˆ¶ç…§ç‰‡
            canvasCtx.drawImage(bgImage, 0, 0, imageWidth, imageHeight);
            // è£å‰ªç…§ç‰‡
            const x = currentDimention[LEFT];
            const y = currentDimention[TOP];
            const width =
              imageWidth - currentDimention[LEFT] - currentDimention[RIGHT];
            const height =
              imageHeight - currentDimention[TOP] - currentDimention[BOTTOM];
            const croppingImageData = canvasCtx.getImageData(
              x,
              y,
              width,
              height
            );
            // é€šè¿‡canvaså±•ç¤ºè£å‰ªçš„ç…§ç‰‡
            const canvasCropping = document.getElementById("canvasCropping");
            const canvasCroppingCtx = canvasCropping.getContext("2d");
            canvasCropping.width = croppingImageData.width;
            canvasCropping.height = croppingImageData.height;
            // æ¸…ç©ºä¸€ä¸‹ç”»å¸ƒ
            canvasCroppingCtx.clearRect(
              0,
              0,
              croppingImageData.width,
              croppingImageData.height
            );
            //å°†è£å‰ªåˆ°çš„ç…§ç‰‡ç»˜åˆ¶åˆ°æ–°çš„ç”»å¸ƒä¸­é¢„è§ˆ
            canvasCroppingCtx.putImageData(croppingImageData, 0, 0);
          }
        });
      });
    </script>
  </body>
</html>
